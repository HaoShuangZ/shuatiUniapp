import{p as a,u as e,v as l,o,d as s,w as t,z as n,m as i,e as c,H as u,G as d,y as p,i as r,x as f,A as g,F as m,O as _,B as v,I as y,aA as C,ae as h,aB as x,h as w,aC as P,l as F,E as b,P as j,D as k}from"./index-25a8f5ab.js";import{_ as I}from"./uni-popup-dialog.7a469b2a.js";import{b as T,a as D,r as V}from"./uni-app.es.64b73443.js";import{_ as A}from"./uni-popup.ec5eff4b.js";import{_ as B}from"./_plugin-vue_export-helper.1b428a4d.js";const $=B({__name:"docView",setup(B){n().appContext.config.globalProperties,T((e=>{console.log(e,"跳转携带的参数",a("docDetail"))})),D((()=>{Object.assign(G,{...a("docDetail")})}));const $=e(null),E=a("userInfo");let G=l({});return(e,l)=>{const n=F,T=b,D=i,B=j,O=V(k("uni-popup-dialog"),I),z=V(k("uni-popup"),A);return o(),s(D,{class:"container"},{default:t((()=>[c(D,{style:{padding:"20rpx"}},{default:t((()=>[u("p",{class:"doc-title"},d(p(G).docName)+d(p(G).type),1),c(D,{class:"doc-info"},{default:t((()=>[c(n,{src:".docx"===p(G).type?"../../static/doc.png":`../../static/${p(G).type}.png`,class:"icon-type",alt:""},null,8,["src"]),r("   "),c(T,null,{default:t((()=>[r(d(p(G).updateTime),1)])),_:1})])),_:1}),c(D,{class:"doc-type"},{default:t((()=>[c(T,null,{default:t((()=>[r(d(p(G).freeFlag?"免费":"开通VIP下载"),1)])),_:1})])),_:1}),c(D,{class:"doc-tag"},{default:t((()=>[(o(!0),f(m,null,g(p(G).tags,(a=>(o(),s(T,{key:a},{default:t((()=>[r("#"+d(a)+"#",1)])),_:2},1024)))),128))])),_:1})])),_:1}),c(D,{class:"doc-text"},{default:t((()=>[c(T,null,{default:t((()=>[r("文档预览")])),_:1})])),_:1}),c(D,{class:"img-view",alt:""},{default:t((()=>[u("ul",null,[(o(!0),f(m,null,g(p(G).previewImages,(a=>(o(),f("li",{key:a},[c(n,{class:"img-item",src:a,alt:""},null,8,["src"])])))),128))])])),_:1}),c(D,{class:"buttom-view"},{default:t((()=>[c(B,{class:"dowload-btn",onClick:l[0]||(l[0]=e=>{return l=p(G).downloadFlag,void(E.vipFlag?(y({title:"加载中",icon:"loading"}),C({url:`${h}/document/download?downloadFlag=${l}`,header:{"Ac-Token":a("token")||""},success:a=>{if(console.log(a,"下载的res"),200===a.statusCode){if("application/json;charset=utf-8"===a.header["Content-Type"])return console.log("res----",a),void y({title:"下载次数已上限!",icon:"error"});x({tempFilePath:a.tempFilePath,success:a=>{console.log("e下载文件的地址",a),setTimeout((()=>{w(),P({filePath:a.savedFilePath,success:a=>{console.log("openDocument",a)},fail:a=>{y({title:"打开失败"+a})}})}),200)},fail:a=>{y({title:"保存失败"+a})}})}},fail:a=>{y({title:"文件下载失败"+a,icon:"none"})}})):_({title:"提示",content:"您未开通VIP,开通后可以下载!",confirmText:"去开通",success:function(a){a.confirm?v({url:"../../pages/vip/vip"}):a.cancel&&console.log("用户点击取消")}}));var l})},{default:t((()=>[r("文档下载")])),_:1})])),_:1}),c(D,null,{default:t((()=>[c(z,{ref_key:"alertDialog",ref:$,type:"dialog"},{default:t((()=>[c(O,{type:"error",cancelText:"取消",confirmText:"去开通",title:"提示",content:"您未开通VIP,开通后可以下载!",onConfirm:e.dialogConfirm,onClose:e.dialogClose},null,8,["onConfirm","onClose"])])),_:1},512)])),_:1}),c(z,{ref:"popup","background-color":"#fff",onChange:e.change},{default:t((()=>[c(D,{class:"popup-content"})])),_:1},8,["onChange"])])),_:1})}}},[["__scopeId","data-v-add98aba"]]);export{$ as default};
