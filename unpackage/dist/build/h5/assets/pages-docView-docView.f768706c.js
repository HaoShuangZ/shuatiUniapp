import{p as a,u as e,v as l,o,d as s,w as t,z as n,m as i,e as c,H as u,G as d,y as p,i as r,x as f,A as g,F as m,R as _,B as y,I as v,ay as C,ae as h,az as x,h as w,aA as F,l as P,E as T,T as b,D as j}from"./index-708d8c77.js";import{_ as k}from"./uni-popup-dialog.fa457da9.js";import{b as I,a as D,r as V}from"./uni-app.es.83c46ea6.js";import{_ as A}from"./uni-popup.231e8e78.js";import{_ as $}from"./_plugin-vue_export-helper.1b428a4d.js";const z=$({__name:"docView",setup($){n().appContext.config.globalProperties,I((e=>{console.log(e,"跳转携带的参数",a("docDetail"))})),D((()=>{Object.assign(R,{...a("docDetail")})}));const z=e(null),H=a("userInfo");let R=l({});return(e,l)=>{const n=P,I=T,D=i,$=b,B=V(j("uni-popup-dialog"),k),E=V(j("uni-popup"),A);return o(),s(D,{class:"container"},{default:t((()=>[c(D,{style:{padding:"20rpx"}},{default:t((()=>[u("p",{class:"doc-title"},d(p(R).docName)+d(p(R).type),1),c(D,{class:"doc-info"},{default:t((()=>[c(n,{src:".docx"===p(R).type?"../../static/doc.png":`../../static/${p(R).type}.png`,class:"icon-type",alt:""},null,8,["src"]),r("   "),c(I,null,{default:t((()=>[r(d(p(R).updateTime),1)])),_:1})])),_:1}),c(D,{class:"doc-type"},{default:t((()=>[c(I,null,{default:t((()=>[r(d(p(R).freeFlag?"免费":"开通VIP下载"),1)])),_:1})])),_:1}),c(D,{class:"doc-tag"},{default:t((()=>[(o(!0),f(m,null,g(p(R).tags,(a=>(o(),s(I,{key:a},{default:t((()=>[r("#"+d(a)+"#",1)])),_:2},1024)))),128))])),_:1})])),_:1}),c(D,{class:"doc-text"},{default:t((()=>[c(I,null,{default:t((()=>[r("文档预览")])),_:1})])),_:1}),c(D,{class:"img-view",alt:""},{default:t((()=>[u("ul",null,[(o(!0),f(m,null,g(p(R).previewImages,(a=>(o(),f("li",{key:a},[c(n,{class:"img-item",src:a,alt:""},null,8,["src"])])))),128))])])),_:1}),c(D,{class:"buttom-view"},{default:t((()=>[c($,{class:"dowload-btn",onClick:l[0]||(l[0]=e=>{return l=p(R).downloadFlag,void(H.vipFlag?(v({title:"加载中",icon:"loading"}),C({url:`${h}/document/download?downloadFlag=${l}`,header:{"Ac-Token":a("token")||""},success:a=>{if(console.log(a,"下载的res"),200===a.statusCode){if("application/json;charset=utf-8"===a.header["Content-Type"])return console.log("res----",a),void v({title:"下载次数已上限!",icon:"error"});x({tempFilePath:a.tempFilePath,success:a=>{console.log("e下载文件的地址",a),setTimeout((()=>{w(),F({filePath:a.savedFilePath,success:a=>{console.log("openDocument",a)},fail:a=>{v({title:"打开失败"+a})}})}),200)},fail:a=>{v({title:"保存失败"+a})}})}},fail:a=>{v({title:"文件下载失败"+a,icon:"none"})}})):_({title:"提示",content:"您未开通VIP,开通后可以下载!",confirmText:"去开通",success:function(a){a.confirm?y({url:"../../pages/vip/vip"}):a.cancel&&console.log("用户点击取消")}}));var l})},{default:t((()=>[r("文档下载")])),_:1})])),_:1}),c(D,null,{default:t((()=>[c(E,{ref_key:"alertDialog",ref:z,type:"dialog"},{default:t((()=>[c(B,{type:"error",cancelText:"取消",confirmText:"去开通",title:"提示",content:"您未开通VIP,开通后可以下载!",onConfirm:e.dialogConfirm,onClose:e.dialogClose},null,8,["onConfirm","onClose"])])),_:1},512)])),_:1}),c(E,{ref:"popup","background-color":"#fff",onChange:e.change},{default:t((()=>[c(D,{class:"popup-content"})])),_:1},8,["onChange"])])),_:1})}}},[["__scopeId","data-v-add98aba"]]);export{z as default};
