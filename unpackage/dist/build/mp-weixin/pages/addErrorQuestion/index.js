"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/config.js"),o={onLoad(e){console.log("onLoad",e,e.feedType),this.feedType=e.feedType},onReady(){},data:()=>({feedType:"",formData:{type:"",feedbackContent:"",questionId:"",userId:"",notesId:"",categoryId:"",contact:""},errTypeArr:[{isCheck:!1,value:"答案有问题"},{isCheck:!1,value:"答案与解析不相符"},{isCheck:!1,value:"有错别字"},{isCheck:!1,value:"选项有问题"},{isCheck:!1,value:"其他"}],feedBack:[{isCheck:!1,value:"答案有问题"},{isCheck:!1,value:"答案与解析不相符"}],feedBackArr:[{isCheck:!1,value:"功能建议"},{isCheck:!1,value:"其他建议"}],rules:{type:{rules:[{required:!0,errorMessage:"请选择错误类型"}]},feedbackContent:{rules:[{required:!0,errorMessage:"具体内容不能为空"}]}}}),methods:{selectFreePhoto(e){e.tempFilePaths.map((e=>{this.imgToBase64(e)}))},imgToBase64(t){e.pathToBase64(t).then((e=>{let t=this.base64toFile(e);this.uploadFileImg(t)})).catch((e=>{console.error(e)}))},selectMoneyPhoto(e){e.tempFilePaths.map((e=>{this.imgToBase64(e,"moneyPhoto")}))},uploadFileImg(o){e.index.uploadFile({url:t.baseUrl+"/customer/common/oss/upload",header:{"Ac-Token":e.index.getStorageSync("token")||""},file:o,name:"file",success:e=>{console.log(e,"图片上传成功")},fail:e=>{console.log("图片上传失败",e)}})},base64toFile(e,t="file"){let o=e.split(","),a=o[0].match(/:(.*?);/)[1],r=a.split("/")[1],s=atob(o[1]),i=s.length,n=new Uint8Array(i);for(;i--;)n[i]=s.charCodeAt(i);return new File([n],`${t}.${r}`,{type:a})},errTypeChange(e,t){let o="";"feedBack"==this.feedType?(console.log(this.feedBackArr,t,e),this.feedBackArr[t].isCheck=!e.isCheck,this.feedBackArr.map((e=>{e.isCheck&&(o+=o?","+e.value:e.value)}))):(this.errTypeArr[t].isCheck=!e.isCheck,this.errTypeArr.map((e=>{e.isCheck&&(o+=o?","+e.value:e.value)}))),this.formData.type=o},submit(e){console.log(this.formData),this.$refs.formRef.validate(((e,t)=>{e||this.addFeedBackSubmit()}))},addFeedBackSubmit(){let t=e.index.getStorageSync("errQuestionDetail"),o=e.index.getStorageSync("userInfo"),a={params:{categoryId:t.categoryId,questionId:t.questionId,question:t,feedbackContent:this.formData.feedbackContent,type:this.formData.type,useFlag:"errAnswerFeed"===this.feedType?0:1,userId:o.userId},callBack:t=>{console.log("res",t),t&&(e.index.showToast({title:"反馈成功",icon:"success",duration:2e3}),setTimeout((()=>{e.index.navigateBack(-1)}),2e3))}};"feedBack"==this.feedType&&delete a.params.question,this.$http("feedBackInfo",a)}}};if(!Array){(e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const a=e._export_sfc(o,[["render",function(t,o,a,r,s,i){return e.e({a:"errAnswerFeed"==s.feedType},"errAnswerFeed"==s.feedType?{b:e.f(s.errTypeArr,((t,o,a)=>({a:e.t(t.value),b:!t.isCheck?"":1,c:o,d:e.o((e=>i.errTypeChange(t,o)),o)})))}:{},{c:"feedBack"==s.feedType},"feedBack"==s.feedType?{d:e.f(s.feedBackArr,((t,o,a)=>({a:e.t(t.value),b:!t.isCheck?"":1,c:o,d:e.o((e=>i.errTypeChange(t,o)),o)})))}:{},{e:e.p({label:"错误类型(可多选)",name:"type",required:!0}),f:e.o((e=>s.formData.feedbackContent=e)),g:e.p({type:"textarea",placeholder:"欢迎您指出具体错误所在，并提供对应的正确描述。您的耐心指点，是我们前进的动力",modelValue:s.formData.feedbackContent}),h:e.p({label:"具体内容",name:"feedbackContent",required:!0}),i:e.o(t.successFreePhoto),j:e.o(t.fail),k:e.o(i.selectFreePhoto),l:e.p({limit:"3",title:"最多选择4张图片","file-mediatype":"image",mode:"grid",limit:3}),m:e.p({label:"上传照片"}),n:e.o((e=>s.formData.contact=e)),o:e.p({type:"text",placeholder:"请输入您的qq号或者手机号,方便我们联系您",modelValue:s.formData.contact}),p:e.p({label:"联系方式"}),q:e.sr("formRef","f11717fa-0"),r:e.o((e=>s.formData=e)),s:e.p({"label-width":"100","label-position":"top",rules:s.rules,modelValue:s.formData}),t:e.o((e=>i.submit("valiForm")))})}]]);wx.createPage(a);
