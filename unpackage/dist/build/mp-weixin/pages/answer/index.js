"use strict";const e=require("../../common/vendor.js"),t=require("../../store/index.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-countdown")+e.resolveComponent("uni-nav-bar")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-countdown/components/uni-countdown/uni-countdown.js")+(()=>"../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const o={__name:"index",setup(o){e.index.getWindowInfo().windowWidth,e.index.getWindowInfo().windowHeight,t.useCategory(),e.ref(1),e.ref(!0);const s=e.ref(0),i=e.ref(0);let n=e.ref(0);const a=e.getCurrentInstance(),{$http:r}=a.appContext.config.globalProperties;e.wx$1.getStorageSync("statusBarHeight"),e.wx$1.getStorageSync("navigationBarHeight"),e.wx$1.getStorageSync("menuButtonHeight");const l=e.wx$1.getStorageSync("statusBarHeight")+e.wx$1.getStorageSync("navigationBarHeight")+"px",u=()=>{console.log("123"),e.index.navigateBack({delta:1})},c=e.ref(null);let d=e.ref("card");const g=e=>{d.value=e,c.value.open("bottom")};let p=e.ref(0);const h=e=>{n.value=e},m=e.ref(!1),f=e=>{m.value=e.show},y=()=>{m.value=!1,c.value.close()};let v=e.ref("");const S=()=>{let t={params:{notesContent:v.value,categoryId:L.value[p.value].categoryId,questionId:L.value[p.value].questionId,userId:e.wx$1.getStorageSync("userInfo").userId,question:L[p.value]},callBack:t=>{console.log("笔记添加成功",t),m.value=!1,c.value.close(),v.value="",e.index.showToast({title:"笔记添加成功",icon:"none",duration:2e3})}};r("addNotes",t)};e.ref([{content:"内容 A"},{content:"内容 B"},{content:"内容 C"}]);let w=e.ref(!1);const q=e=>{p.value=e.detail.current,w.value=L.value[e.detail.current].collectFlag},x=(e,t,o)=>{if(console.log("opt",e),o.answer.push(e.label),console.log("选择答案后是否插入了当前选择的数据",o,e.label),!o.isSelected&&"单选题"===o.questionTypeName){e.isChecked=!0,o.isSelected=!0;let t=0;o.optionsList.map(((e,o)=>{e.isRight&&(e.isChecked=!0),e.isChecked&&t++})),1==t?(o.isSelectRight=!0,b.push({categoryId:o.categoryId,questionId:o.questionId,status:1,questionTypeName:o.questionTypeName})):(o.isSelectRight=!1,console.log("添加错题的数据",o,e.label),!o.errorHistoryFlag&&R(o.categoryId,o.questionId,2,o.answer),b.push({answer:o.answer,categoryId:o.categoryId,questionId:o.questionId,status:2,questionTypeName:o.questionTypeName})),I(o)}o.isSelected||"多选题"!==o.questionTypeName||(e.isChecked=!0)},I=t=>{let o=e.index.getStorageSync("answerDataList")||[];o.push(e.toRaw(t)),console.log("插入后的答题数据",o),e.index.setStorageSync("answerDataList",o)},T=(e,t)=>{if(e.length!==t.length)return!1;const o=e.sort(),s=t.sort();return JSON.stringify(o)===JSON.stringify(s)};e.computed((()=>""));const k=(t,o,s)=>{let i=e.index.getStorageSync("userInfo"),n=s.map((e=>({answers:e.answer,questionId:e.questionId,rightFlag:e.isSelectRight}))),a={params:{errorNum:t.errNum,successNum:t.rightNum,score:t.total,userId:i.userId,examData:{answerResults:n,computeScoreType:o.moreDataWay,firstErrorQuestion:o.worongPrior,notAnswerQuestionFirst:o.doneNot,selectOutOfOrder:o.optionOrder,showAnswer:o.showAnswer,timeNum:o.examTime}},callBack:e=>{console.log("添加考试记录的回调",e)}};r("addExamRecord",a)},C=t=>{let o=e.index.getStorageSync("answerDataList"),s=e.index.getStorageSync("examSetting"),i={answerRate:0,total:0,rightNum:0,errNum:0,currentTime:""};o.map((e=>{T(e.answer,e.rightOptions)?i.rightNum+=1:i.errNum+=1,i.total+=1})),i.answerRate=(Math.round(i.rightNum)/i.total*1e4/100).toFixed(2)+"%",e.index.setStorageSync("exerciseResult",i),i.total,i.total,i.errNum,1===t?e.index.showModal({title:"提示",content:"已完成所有试题，现在交卷嘛？",success:function(t){t.confirm?(k(i,s,o),e.index.redirectTo({url:"../exerciseResult/exerciseResult"})):t.cancel&&console.log("用户点击取消")}}):(e.index.showToast({title:"考试时间结束！",icon:"error",duration:1500}),k(i,s,o),setTimeout((()=>{e.index.redirectTo({url:"../exerciseResult/exerciseResult"})}),1500)),console.log("正确率",i)},N=e=>{console.log("考试交卷",e),C("endTime"==e?0:1)},R=(e,t,o,s)=>{console.log("添加错题",s),r("addErrQuestion",{params:{categoryId:e,questionId:t,status:o,answer:s},callBack:e=>{console.log("错题添加成功",e)}})},b=e.reactive([]);e.computed((()=>L.value[p.value].collectFlag));let L=e.ref([]);const B=e.reactive({page:1,size:10,total:10}),F=["A","B","C","D","E","F"],O=t=>{e.index.showLoading({title:"加载中..."}),5!=t.type&&6!=t.type||delete t.categoryId,r("getQuestionList",{params:t,callBack:o=>{e.index.hideLoading(),console.log("res",o.records),3==t.type&&(console.log("顺序随机"),o.records.sort((function(){return Math.random()-.5}))),o.records.map(((e,t)=>{const o=e.options.map((e=>({label:e,isChecked:"",isRight:!1})));let s=[];e.options.map(((t,o)=>{e.rightOptions.map(((e,i)=>{t===e&&s.push(o)}))})),e.rightAnswerItem=s;const i=o.map((t=>(e.rightOptions.includes(t.label)&&(t.isRight=!0),t)));e.optionsList=i,e.isSelected=!1,e.answer=[]})),L.value=[...L.value,...o.records],o.records.length>0&&(w.value=o.records[p.value].collectFlag,B.page=o.page,B.size=o.size,B.total=o.total)}})},z=e.reactive({...e.index.getStorageSync("examSetting")});let j=e.ref(!1);return e.onLoad((t=>{console.log("listType",t);let o={type:t.listType,categoryId:e.index.getStorageSync("currentCategoryId"),difficulty:(null==t?void 0:t.difficulty)??"",paperId:Number(null==t?void 0:t.paperId)??"",questionTypeCode:"",questionTypeName:(null==t?void 0:t.questionTypeName)??"",page:B.page,size:B.size};if(11==t.listType)n.value=1,(()=>{let e={params:{page:B.page,size:B.size},callBack:e=>{console.log("获取错题数据",e),e.records.map(((e,t)=>{const o=e.question.options.map((e=>({label:e,isChecked:"",isRight:!1})));console.log("optionObjects",o);const s=o.map((t=>(e.question.rightOptions.includes(t.label)&&(t.isRight=!0),t)));e.question.optionsList=s,e.question.isSelected=!1}));let t=e.records.map((e=>e.question));L.value=[...t],w.value=e.records[p.value].collectFlag,B.page=e.page,B.size=e.size,B.total=e.total}};r("getErrorQuestionList",e)})();else if(1==t.listType){j.value=!0;let s=e.index.getStorageSync("examSetting"),i=Object.assign({},o,{type:t.listType,page:1,size:s.radio,questionTypeName:"单选题"}),n=Object.assign({},i,{size:s.multipleScore,questionTypeName:"多选题"});O(i),O(n)}else O(o)})),e.onHide((()=>{console.log("隐藏页面")})),e.onUnload((()=>{console.log("页面销毁"),b.length>0&&r("addErrQuestionList",{params:{questionRecordList:b},callBack:e=>{console.log("批量添加错题记录",e)}})})),e.onReady((()=>{})),(t,o)=>e.e({a:"overflow:"+(m.value?"hidden":"visible"),b:e.o(u),c:e.p({type:"back",color:"#000",size:"24"}),d:e.unref(j)},e.unref(j)?{e:e.o((e=>N("endTime"))),f:e.p({"show-day":!1,hour:0,minute:Number(z.examTime),second:0})}:{g:e.o((e=>h(0))),h:e.unref(n)?"":1,i:e.o((e=>h(1))),j:e.unref(n)?1:""},{k:l,l:e.p({"status-bar":!0,title:""}),m:e.f(e.unref(L),((o,s,i)=>e.e({a:e.t(o.difficulty),b:e.t(s+1),c:e.t(o.questionTitle),d:"单选题"===o.questionTypeName&&0===e.unref(n)},"单选题"===o.questionTypeName&&0===e.unref(n)?{e:e.f(o.optionsList,((t,s,i)=>e.e({a:!o.isSelected||!t.isChecked},o.isSelected&&t.isChecked?{}:{b:e.t(F[s])},{c:!0===o.isSelected&&t.isRight?1:"",d:!0===t.isChecked&&t.isChecked!==t.isRight?1:"",e:e.t(t.label),f:!0===o.optionsList.isSelected&&t.isRight?1:"",g:!0===t.isChecked&&t.isChecked!==t.isRight?1:"",h:s,i:e.o((e=>x(t,0,o)),s)})))}:{},{f:"多选题"===o.questionTypeName&&0===e.unref(n)},"多选题"===o.questionTypeName&&0===e.unref(n)?{g:e.f(o.optionsList,((t,s,i)=>({a:e.t(F[s]),b:t.isChecked||!0===o.isSelected&&t.isRight?1:"",c:!0===o.isSelected&&!0===t.isChecked&&t.isChecked!==t.isRight?1:"",d:e.t(t.label),e:t.isChecked?1:"",f:!0===o.isSelected&&t.isChecked&&t.isChecked!==t.isRight?1:"",g:s,h:e.o((e=>x(t,0,o)),s)})))}:{},1===e.unref(n)?e.e({h:"单选题"===o.questionTypeName},"单选题"===o.questionTypeName?{i:e.f(o.optionsList,((t,s,i)=>e.e({a:!o.isSelected||!t.isChecked},o.isSelected&&t.isChecked?{}:{b:e.t(t.isRight?null:F[s])},{c:t.isRight?1:"",d:!0===t.isChecked&&t.isChecked!==t.isRight?1:"",e:e.t(t.label),f:t.isRight?1:"",g:!0===t.isChecked&&t.isChecked!==t.isRight?1:"",h:s})))}:{},{j:"多选题"===o.questionTypeName},"多选题"===o.questionTypeName?{k:e.f(o.optionsList,((t,s,i)=>({a:e.t(F[s]),b:t.isRight?1:"",c:!0===o.isSelected&&!0===t.isChecked&&t.isChecked!==t.isRight?1:"",d:e.t(t.label),e:t.isRight?1:"",f:!0===o.isSelected&&t.isChecked&&t.isChecked!==t.isRight?1:"",g:s})))}:{}):{},{l:0===e.unref(n)&&"多选题"==o.questionTypeName&&!o.isSelected},0!==e.unref(n)||"多选题"!=o.questionTypeName||o.isSelected?{}:{m:e.o((e=>((e,t,o)=>{o.isSelected=!0;let s=T(o.answer,o.rightOptions)?1:2;console.log("选项中选择的是否都真确",s),R(o.categoryId,o.questionId,s,o.answer),b.push({answer:o.answer,categoryId:o.categoryId,questionId:o.questionId,status:s,questionTypeName:o.questionTypeName}),I(o)})(t.option,t.optionIndex,o)),s)},{n:o.isSelected||1==e.unref(n)},o.isSelected||1==e.unref(n)?{o:e.f(o.options,((t,s,i)=>({a:e.f(o.rightOptions,((o,i,n)=>({a:e.t(t==o?F[s]:""),b:o}))),b:s}))),p:e.t(t.currentQuestionRightItem),q:e.o((t=>{return s=o,e.index.setStorageSync("errQuestionDetail",s),void e.index.navigateTo({url:"../addErrorQuestion/index?feedType=errAnswerFeed"});var s}),s)}:{},{r:o.isSelected||1==e.unref(n)},(o.isSelected||e.unref(n),{}),{s:o.isSelected||1==e.unref(n)},o.isSelected||1==e.unref(n)?{t:e.t(o.analysis),v:e.o((e=>g("notes")),s)}:{},{w:s}))),n:1===e.unref(n),o:e.unref(p),p:e.o(q),q:e.unref(j)},e.unref(j)?{r:e.o((e=>N("click")))}:{},{s:!e.unref(w)},(e.unref(w),{}),{t:e.o((t=>(t=>{console.log("收藏问题",t);let o={params:{categoryId:L.value[p.value].categoryId,questionId:L.value[p.value].questionId,questionTypeName:L.value[p.value].questionTypeName,collectType:2},callBack:o=>{w.value=!w.value,L.value[p.value].collectFlag=!t,e.index.showToast({title:t?"删除成功":"收藏成功",icon:"none",duration:2e3})}};r(t?"removeCollectQuestion":"collectQuestion",o)})(e.unref(w)))),v:!e.unref(j)},(e.unref(j),{}),{w:e.t(s.value),x:e.t(i.value),y:e.o((e=>g("card"))),z:"card"===e.unref(d)},"card"===e.unref(d)?{A:e.f(e.unref(L),((t,o,s)=>e.e({a:e.t(t.isSelectRight),b:e.t(o+1),c:t.collectFlag},(t.collectFlag,{}),{d:t.errorHistoryFlag?1:"",e:t.errorHistoryFlag?1:"",f:e.unref(p)==o?1:"",g:e.o((e=>(e=>{p.value=e,m.value=!1,c.value.close()})(o)),o),h:o}))),B:""}:{},{C:"notes"===e.unref(d)},"notes"===e.unref(d)?{D:e.o(y),E:e.p({type:"closeempty",size:"20"}),F:e.o(S),G:e.unref(v),H:e.o((t=>e.isRef(v)?v.value=t.detail.value:v=t.detail.value))}:{},{I:e.sr(c,"54be9d58-3",{k:"popup"}),J:e.o(f),K:e.p({"background-color":"#fff"})})}};wx.createPage(o);
