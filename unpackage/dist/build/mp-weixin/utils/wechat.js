"use strict";const e=require("../common/vendor.js"),n=require("./http.js"),o={isWechat:()=>"micromessenger"==window.navigator.userAgent.toLowerCase().match(/micromessenger/i),getUserInfo:()=>new Promise(((n,o)=>{e.index.getUserProfile({desc:"获取个人信息",success:e=>{n(e.userInfo)},fail:e=>{o(e)}})})),getJsCode:()=>new Promise(((n,o)=>{e.index.login({success(e){n(e.code)},fail:e=>{o(e)}})})),getUserPhone(o){let t={params:{openId:e.index.getStorageSync("openid"),sessionKey:e.index.getStorageSync("sessionKey"),encryptedDataUserInfo:e.index.getStorageSync("encryptedDataUserInfo"),ivUserInfo:e.index.getStorageSync("ivUserInfo"),encryptedData:o.encryptedData,iv:o.iv,unionId:o.cloudID},"Content-Type":"application/json",callBack:n=>{console.log("获取手机号",n),n&&e.index.switchTab({url:"/pages/my/my"})}};n.request("getPhone",t)},wxLogin(){e.index.login({provider:"weixin",success:function(o){if("login:ok"===o.errMsg){let t={params:{code:o.code},callBack:n=>{e.index.setStorageSync("openid",n.openid),e.index.setStorageSync("sessionKey",n.sessionKey),e.index.setStorageSync("minAppNewUserFlag",n.minAppNewUserFlag),n.minAppNewUserFlag||(e.index.setStorageSync("userInfo",n),e.index.setStorageSync("token",n.token))},contentType:"application/x-www-form-urlencoded"};n.request("login",t)}}})},callWexinPay(n,o,t){n.appId;const i=n.timeStamp,s=n.nonceStr,c=n.packageValue,r=n.paySign,a=n.signType,g=n.desc;this.getWxConfig((()=>{e.wx$1.ready((function(){console.log(n),e.wx$1.chooseWXPay({timestamp:i,nonceStr:s,package:c,signType:a,paySign:r,desc:g,success:function(e){o(e)},fail:function(e){t(e)}})})),e.wx$1.error((function(e){}))}))},callWexinShare(n,o,t){this.getWxConfig((()=>{e.wx$1.ready((function(){console.log(JSON.stringify(n)),e.wx$1.updateAppMessageShareData({title:n.title,link:n.link,imgUrl:n.imgUrl,desc:n.desc,success:function(e){o(e)},cancel:function(e){t(e)}})})),e.wx$1.error((function(e){}))}))},scanQRCode(n,o){this.getWxConfig((()=>{e.wx$1.ready((function(){e.wx$1.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){var o=e.resultStr;n(o)},fail:function(e){o(e)}})})),e.wx$1.error((function(e){}))}))},getLocation(n,o){this.getWxConfig((()=>{e.wx$1.ready((function(){e.wx$1.getLocation({type:"wgs84",success:function(e){n(e)},fail:function(e){o(e)}})})),e.wx$1.error((function(e){}))}))}};exports.wechat=o;
