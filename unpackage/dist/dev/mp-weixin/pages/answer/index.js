"use strict";const e=require("../../common/vendor.js"),re=require("../../store/index.js");if(!Array){const L=e.resolveComponent("uni-icons"),N=e.resolveComponent("uni-countdown"),_=e.resolveComponent("uni-nav-bar"),d=e.resolveComponent("uni-popup");(L+N+_+d)()}const ne=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",oe=()=>"../../uni_modules/uni-countdown/components/uni-countdown/uni-countdown.js",ae=()=>"../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js",ce=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(ne+oe+ae+ce)();const ie={__name:"index",setup(L){e.index.getWindowInfo().windowWidth+"",e.index.getWindowInfo().windowHeight+"",re.useCategory(),e.ref(1),e.ref(!0);const N=e.ref(0),_=e.ref(0);let d=e.ref(0);const j=e.getCurrentInstance(),{$http:h}=j.appContext.config.globalProperties;e.wx$1.getStorageSync("statusBarHeight")+"",e.wx$1.getStorageSync("navigationBarHeight")+"",e.wx$1.getStorageSync("menuButtonHeight")+"";const M=e.wx$1.getStorageSync("statusBarHeight")+e.wx$1.getStorageSync("navigationBarHeight")+"px",P=()=>{console.log("123"),e.index.navigateBack({delta:1})},b=e.ref(500),p=e.reactive({total:"",size:"",page:"",categoryId:e.index.getStorageSync("currentCategoryId")||e.index.getStorageSync("fCurrentCategoryId"),currentIndex:""}),z=()=>{u.value&&(p.currentIndex=u.value)},A=()=>{let s=e.index.getStorageSync("currentAnswerRecordList")||[];s.length||s.push({...p}),s.map(o=>{o.categoryId==p.categoryId?(o.currentIndex=p.currentIndex||u.value,o.page=p.page,o.size=p.size,o.total=p.total):s.push({...p})}),e.index.setStorageSync("currentAnswerRecordList",s)};let u=e.ref(0);const I=e.ref(null);let w=e.ref("card");const Q=s=>{s=="notes",w.value=s,I.value.open("bottom")},W=s=>{b.value=0,u.value=s,C.value=!1,I.value.close(),setTimeout(()=>{b.value=500},1e3)},B=s=>{d.value=s},C=e.ref(!1),J=s=>{C.value=s.show},U=()=>{C.value=!1,I.value.close()};let x=e.ref("");const G=()=>{let s={params:{notesContent:x.value,categoryId:g.value[u.value].categoryId,questionId:g.value[u.value].questionId,userId:e.wx$1.getStorageSync("userInfo").userId,question:g[u.value]},callBack:o=>{console.log("笔记添加成功",o),C.value=!1,I.value.close(),x.value="",e.index.showToast({title:"笔记添加成功",icon:"none",duration:2e3})}};h("addNotes",s)};e.ref([{content:"内容 A"},{content:"内容 B"},{content:"内容 C"}]);let y=e.ref(!1);const K=s=>{console.log("分页滑动",s),u.value=s.detail.current,y.value=g.value[s.detail.current].collectFlag,u.value<i.total&&u.value===i.page*i.size-1&&k()},F=(s,o,t)=>{if(console.log("opt",s),t.answer.push(s.label),console.log("选择答案后是否插入了当前选择的数据",t,s.label),!t.isSelected&&t.questionTypeName==="单选题"){s.isChecked=!0,t.isSelected=!0;let r=0;t.optionsList.map((a,n)=>{a.isRight&&(a.isChecked=!0),a.isChecked&&r++}),r==1?(t.isSelectRight=!0,m.push({categoryId:t.categoryId,questionId:t.questionId,status:1,questionTypeName:t.questionTypeName})):(t.isSelectRight=!1,console.log("添加错题的数据",t,s.label),D(t.categoryId,t.questionId,2,t.answer),m.push({answer:t.answer,categoryId:t.categoryId,questionId:t.questionId,status:2,questionTypeName:t.questionTypeName})),$(t)}!t.isSelected&&t.questionTypeName==="多选题"&&(s.isChecked=!0),z()},$=s=>{let o=e.index.getStorageSync("answerDataList")||[];o.push(e.toRaw(s)),console.log("插入后的答题数据",o),e.index.setStorageSync("answerDataList",o)},E=(s,o)=>{if(s.length!==o.length)return!1;const t=s.sort(),r=o.sort(),a=JSON.stringify(t),n=JSON.stringify(r);return a===n},V=(s,o,t)=>{t.isSelected=!0;let a=E(t.answer,t.rightOptions)?1:2;console.log("选项中选择的是否都真确",a),D(t.categoryId,t.questionId,a,t.answer),m.push({answer:t.answer,categoryId:t.categoryId,questionId:t.questionId,status:a,questionTypeName:t.questionTypeName}),$(t),z()};e.computed(()=>"");const O=(s,o,t)=>{let r=e.index.getStorageSync("userInfo"),a=t.map(c=>({answers:c.answer,questionId:c.questionId,rightFlag:c.isSelectRight})),n={params:{errorNum:s.errNum,successNum:s.rightNum,score:s.total,userId:r.userId,examData:{answerResults:a,computeScoreType:o.moreDataWay,firstErrorQuestion:o.worongPrior,notAnswerQuestionFirst:o.doneNot,selectOutOfOrder:o.optionOrder,showAnswer:o.showAnswer,timeNum:o.examTime}},callBack:c=>{console.log("添加考试记录的回调",c)}};h("addExamRecord",n)},H=s=>{let o=e.index.getStorageSync("answerDataList"),t=e.index.getStorageSync("examSetting"),r={answerRate:0,total:0,rightNum:0,errNum:0,currentTime:""};o.map(a=>{E(a.answer,a.rightOptions)?r.rightNum+=1:r.errNum+=1,r.total+=1}),r.answerRate=(Math.round(r.rightNum)/r.total*1e4/100).toFixed(2)+"%",e.index.setStorageSync("exerciseResult",r),r.total>r.total+r.errNum,s===1?e.index.showModal({title:"提示",content:"已完成所有试题，现在交卷嘛？",success:function(a){a.confirm?(O(r,t,o),e.index.redirectTo({url:"../exerciseResult/exerciseResult"})):a.cancel&&console.log("用户点击取消")}}):(e.index.showToast({title:"考试时间结束！",icon:"error",duration:1500}),O(r,t,o),setTimeout(()=>{e.index.redirectTo({url:"../exerciseResult/exerciseResult"})},1500)),console.log("正确率",r)},q=s=>{console.log("考试交卷",s),s=="endTime"?H(0):H(1)},X=s=>{e.index.setStorageSync("errQuestionDetail",s),e.index.navigateTo({url:"../addErrorQuestion/index?feedType=errAnswerFeed"})},D=(s,o,t,r)=>{console.log("添加错题",r),h("addErrQuestion",{params:{categoryId:s,questionId:o,status:t,answer:r},callBack:n=>{console.log("错题添加成功",n)}})},m=e.reactive([]),Y=()=>{h("addErrQuestionList",{params:{questionRecordList:m},callBack:o=>{console.log("批量添加错题记录",o)}})},Z=s=>{console.log("收藏问题",s);let o={params:{categoryId:g.value[u.value].categoryId,questionId:g.value[u.value].questionId,questionTypeName:g.value[u.value].questionTypeName,collectType:2},callBack:t=>{y.value=!y.value,g.value[u.value].collectFlag=!s,e.index.showToast({title:s?"删除成功":"收藏成功",icon:"none",duration:2e3})}};h(s?"removeCollectQuestion":"collectQuestion",o)};e.computed(()=>g.value[u.value].collectFlag);let g=e.ref([]);const i=e.reactive({page:1,size:50,total:50}),T=["A","B","C","D","E","F"],k=s=>{e.index.showLoading({title:"加载中..."}),setTimeout(()=>{e.index.hideLoading()},1e3),(s.type==5||s.type==6)&&delete s.categoryId,h("getQuestionList",{params:s,callBack:t=>{e.index.hideLoading(),console.log("res",t.records),s.type==1&&t.records.map((r,a)=>{r.index=i.page>1?i.page*i.size+a:a}),s.type==3&&t.records.sort(function(){return Math.random()-.5}),s.type==0&&t.total&&t.pages&&t.size&&(p.total=t.total,p.page=t.pages,p.size=t.size),console.log("获取缓存的数据",p),t.records.map((r,a)=>{r.answer=[],r.isSelectRight=!1,r.isSelected=!1,r.isSelected=!1;const n=r.options.map(l=>{let v={label:l,isChecked:"",isRight:!1};return r.errorHistoryFlag&&r.rightOptions.includes(l)&&(console.log("=====",r),r.isSelectRight=!0,r.isSelected=!0,v.isChecked=!0),r.errorQuestionRecord&&r.errorHistoryFlag===!1&&r.errorQuestionRecord&&r.errorQuestionRecord.answer.map(R=>{r.isSelectRight=!1,r.isSelected=!0,r.rightOptions.includes(l)&&(v.isChecked=!0),R===l&&(v.isChecked=!0,r.answer=r.errorQuestionRecord.answer)}),v});let c=[];r.options.map((l,v)=>{r.rightOptions.map((R,ue)=>{l===R&&c.push(v)})}),r.rightAnswerItem=c;const f=n.map(l=>(r.rightOptions.includes(l.label)&&(l.isRight=!0),l));r.optionsList=f}),g.value=[...g.value,...t.records],t.records.length>0&&(y.value=t.records[u.value].collectFlag,i.page=t.page,i.size=t.size,i.total=t.total)}})},ee=()=>{let s={params:{page:i.page,size:i.size,categoryId:e.index.getStorageSync("currentCategoryId")||e.index.getStorageSync("fCurrentCategoryId")},callBack:o=>{console.log("获取的收藏列表",o),o.records.map((t,r)=>{const a=t.options.map(f=>({label:f,isChecked:"",isRight:!1}));let n=[];t.options.map((f,l)=>{t.rightOptions.map((v,R)=>{f===v&&n.push(l)})}),t.rightAnswerItem=n;const c=a.map(f=>(t.rightOptions.includes(f.label)&&(f.isRight=!0),f));t.optionsList=c,t.isSelected=!1,t.answer=[]}),g.value=[...g.value,...o.records],o.records.length>0&&(y.value=o.records[u.value].collectFlag,i.page=o.page,i.size=o.size,i.total=o.total)}};h("getCollectQuestion",s)},te=s=>{let o={params:{page:i.page,size:i.size,categoryId:e.index.getStorageSync("currentCategoryId")||e.index.getStorageSync("fCurrentCategoryId"),status:2},callBack:t=>{console.log("获取错题数据",t),t.records.map((a,n)=>{const c=a.question.options.map(l=>({label:l,isChecked:"",isRight:!1}));console.log("optionObjects",c);const f=c.map(l=>(a.question.rightOptions.includes(l.label)&&(l.isRight=!0),l));a.question.optionsList=f,a.question.isSelected=!1});let r=t.records.map(a=>a.question);g.value=[...r],y.value=t.records[u.value].collectFlag,i.page=t.page,i.size=t.size,i.total=t.total}};h("getErrorQuestionList",o)},se=e.reactive({...e.index.getStorageSync("examSetting")});let S=e.ref(!1);return e.onLoad(s=>{const o=e.index.getStorageSync("currentAnswerRecordList");i.page=o.page||1,i.size=o.size||50,console.log("listType",s);let t={type:s.listType,categoryId:e.index.getStorageSync("currentCategoryId")||e.index.getStorageSync("fCurrentCategoryId"),difficulty:(s==null?void 0:s.difficulty)??"",paperId:Number(s==null?void 0:s.paperId)??"",questionTypeCode:"",questionTypeName:(s==null?void 0:s.questionTypeName)??"",page:i.page,size:i.size};if(s.listType==0&&o&&o.map(r=>{r.categoryId==t.categoryId&&(u.value=r.currentIndex||0)}),s.listType==11)d.value=1,te(s.listType);else if(s.listType==12)ee();else if(s.listType==1){S.value=!0;let r=e.index.getStorageSync("examSetting"),a=Object.assign({},t,{type:s.listType,page:1,size:r.radio,questionTypeName:"单选题"}),n=Object.assign({},a,{size:r.multipleScore,questionTypeName:"多选题"});k(a),k(n)}else k(t)}),e.onHide(()=>{A()}),e.onUnload(()=>{A(),m.length>0&&Y()}),e.onReady(()=>{}),(s,o)=>e.e({a:"overflow:"+(C.value?"hidden":"visible"),b:e.o(P),c:e.p({type:"back",color:"#000",size:"24"}),d:e.unref(S)},e.unref(S)?{e:e.o(t=>q("endTime")),f:e.p({["show-day"]:!1,hour:0,minute:Number(se.examTime),second:0})}:{g:e.o(t=>B(0)),h:e.unref(d)?"":1,i:e.o(t=>B(1)),j:e.unref(d)?1:""},{k:M,l:e.p({["status-bar"]:!0,title:""}),m:e.f(e.unref(g),(t,r,a)=>e.e({a:e.t(t.difficulty),b:e.t(t.questionTitle),c:t.questionTypeName==="单选题"&&e.unref(d)===0},t.questionTypeName==="单选题"&&e.unref(d)===0?{d:e.f(t.optionsList,(n,c,f)=>e.e({a:!t.isSelected||!n.isChecked},!t.isSelected||!n.isChecked?{b:e.t(T[c])}:{},{c:t.isSelected===!0&&n.isRight?1:"",d:n.isChecked===!0&&n.isChecked!==n.isRight?1:"",e:e.t(n.label),f:t.optionsList.isSelected===!0&&n.isRight?1:"",g:n.isChecked===!0&&n.isChecked!==n.isRight?1:"",h:c,i:e.o(l=>F(n,c,t),c)}))}:{},{e:t.questionTypeName==="多选题"&&e.unref(d)===0},t.questionTypeName==="多选题"&&e.unref(d)===0?{f:e.f(t.optionsList,(n,c,f)=>({a:e.t(T[c]),b:n.isChecked||t.isSelected===!0&&n.isRight?1:"",c:t.isSelected===!0&&n.isChecked===!0&&n.isChecked!==n.isRight?1:"",d:e.t(n.label),e:n.isChecked?1:"",f:t.isSelected===!0&&n.isChecked&&n.isChecked!==n.isRight?1:"",g:c,h:e.o(l=>F(n,c,t),c)}))}:{},e.unref(d)===1?e.e({g:t.questionTypeName==="单选题"},t.questionTypeName==="单选题"?{h:e.f(t.optionsList,(n,c,f)=>e.e({a:!t.isSelected||!n.isChecked},!t.isSelected||!n.isChecked?{b:e.t(n.isRight?null:T[c])}:{},{c:n.isRight?1:"",d:n.isChecked===!0&&n.isChecked!==n.isRight?1:"",e:e.t(n.label),f:n.isRight?1:"",g:n.isChecked===!0&&n.isChecked!==n.isRight?1:"",h:c}))}:{},{i:t.questionTypeName==="多选题"},t.questionTypeName==="多选题"?{j:e.f(t.optionsList,(n,c,f)=>({a:e.t(T[c]),b:n.isRight?1:"",c:t.isSelected===!0&&n.isChecked===!0&&n.isChecked!==n.isRight?1:"",d:e.t(n.label),e:n.isRight?1:"",f:t.isSelected===!0&&n.isChecked&&n.isChecked!==n.isRight?1:"",g:c}))}:{}):{},{k:e.unref(d)===0&&t.questionTypeName=="多选题"&&!t.isSelected},e.unref(d)===0&&t.questionTypeName=="多选题"&&!t.isSelected?{l:e.o(n=>V(s.option,s.optionIndex,t),r)}:{},{m:t.isSelected||e.unref(d)==1},t.isSelected||e.unref(d)==1?{n:e.f(t.options,(n,c,f)=>({a:e.f(t.rightOptions,(l,v,R)=>({a:e.t(n==l?T[c]:""),b:l})),b:c})),o:e.t(s.currentQuestionRightItem),p:e.o(n=>X(t),r)}:{},{q:t.isSelected||e.unref(d)==1},t.isSelected||e.unref(d)==1?{}:{},{r:t.isSelected||e.unref(d)==1},t.isSelected||e.unref(d)==1?{s:e.t(t.analysis),t:e.o(n=>Q("notes"),r)}:{},{v:r})),n:e.t(e.unref(u)+1),o:e.unref(d)===1,p:b.value,q:e.unref(u),r:e.o(K),s:e.unref(S)},e.unref(S)?{t:e.o(t=>q("click"))}:{},{v:!e.unref(y)},e.unref(y)?{}:{},{w:e.o(t=>Z(e.unref(y))),x:!e.unref(S)},e.unref(S)?{}:{},{y:e.t(N.value),z:e.t(_.value),A:e.o(t=>Q("card")),B:e.unref(w)==="card"},e.unref(w)==="card"?{C:e.f(e.unref(g),(t,r,a)=>e.e({a:e.t(r+1),b:t.collectFlag},t.collectFlag?{}:{},{c:t.errorHistoryFlag?1:"",d:t.errorHistoryFlag?1:"",e:e.unref(u)==r?1:"",f:e.o(n=>W(r),r),g:r})),D:""}:{},{E:e.unref(w)==="notes"},e.unref(w)==="notes"?{F:e.o(U),G:e.p({type:"closeempty",size:"20"}),H:e.o(G),I:e.unref(x),J:e.o(t=>e.isRef(x)?x.value=t.detail.value:x=t.detail.value)}:{},{K:e.sr(I,"54be9d58-3",{k:"popup"}),L:e.o(J),M:e.p({["background-color"]:"#fff"})})}},le=e._export_sfc(ie,[["__file","C:/Users/sygen/Documents/HBuilderProjects/brushQuestion-front/pages/answer/index.vue"]]);wx.createPage(le);
