"use strict";const e=require("../../common/vendor.js"),f=require("../../utils/config.js"),m={onLoad(u){console.log("onLoad",u,u.feedType),this.feedType=u.feedType},onReady(){},data(){return{feedType:"",formData:{type:"",feedbackContent:"",questionId:"",userId:"",notesId:"",categoryId:"",contact:""},errTypeArr:[{isCheck:!1,value:"答案有问题"},{isCheck:!1,value:"答案与解析不相符"},{isCheck:!1,value:"有错别字"},{isCheck:!1,value:"选项有问题"},{isCheck:!1,value:"其他"}],feedBack:[{isCheck:!1,value:"答案有问题"},{isCheck:!1,value:"答案与解析不相符"}],feedBackArr:[{isCheck:!1,value:"功能建议"},{isCheck:!1,value:"其他建议"}],rules:{type:{rules:[{required:!0,errorMessage:"请选择错误类型"}]},feedbackContent:{rules:[{required:!0,errorMessage:"具体内容不能为空"}]}}}},methods:{selectFreePhoto(u){u.tempFilePaths.map(s=>{this.imgToBase64(s)})},imgToBase64(u){e.pathToBase64(u).then(s=>{let o=this.base64toFile(s);this.uploadFileImg(o)}).catch(s=>{console.error(s)})},selectMoneyPhoto(u){u.tempFilePaths.map(s=>{this.imgToBase64(s,"moneyPhoto")})},uploadFileImg(u){e.index.uploadFile({url:f.baseUrl+"/customer/common/oss/upload",header:{"Ac-Token":e.index.getStorageSync("token")||""},file:u,name:"file",success:s=>{console.log(s,"图片上传成功")},fail:s=>{console.log("图片上传失败",s)}})},base64toFile(u,s="file"){let o=u.split(","),r=o[0].match(/:(.*?);/)[1],i=r.split("/")[1],n=atob(o[1]),t=n.length,a=new Uint8Array(t);for(;t--;)a[t]=n.charCodeAt(t);return new File([a],`${s}.${i}`,{type:r})},errTypeChange(u,s){let o="";this.feedType=="feedBack"?(console.log(this.feedBackArr,s,u),this.feedBackArr[s].isCheck=!u.isCheck,this.feedBackArr.map(r=>{r.isCheck&&(o?o+=","+r.value:o+=r.value)})):(this.errTypeArr[s].isCheck=!u.isCheck,this.errTypeArr.map(r=>{r.isCheck&&(o?o+=","+r.value:o+=r.value)})),this.formData.type=o},submit(u){console.log(this.formData),this.$refs.formRef.validate((s,o)=>{s||this.addFeedBackSubmit()})},addFeedBackSubmit(){let u=e.index.getStorageSync("errQuestionDetail"),s=e.index.getStorageSync("userInfo"),o={params:{categoryId:u.categoryId,questionId:u.questionId,question:u,feedbackContent:this.formData.feedbackContent,type:this.formData.type,useFlag:this.feedType==="errAnswerFeed"?0:1,userId:s.userId},callBack:r=>{console.log("res",r),r&&(e.index.showToast({title:"反馈成功",icon:"success",duration:2e3}),setTimeout(()=>{e.index.navigateBack(-1)},2e3))}};this.feedType=="feedBack"&&delete o.params.question,this.$http("feedBackInfo",o)}}};if(!Array){const u=e.resolveComponent("uni-forms-item"),s=e.resolveComponent("uni-easyinput"),o=e.resolveComponent("uni-file-picker"),r=e.resolveComponent("uni-forms");(u+s+o+r)()}const p=()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js",d=()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js",h=()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js",y=()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js";Math||(p+d+h+y)();function F(u,s,o,r,i,n){return e.e({a:i.feedType=="errAnswerFeed"},i.feedType=="errAnswerFeed"?{b:e.f(i.errTypeArr,(t,a,l)=>({a:e.t(t.value),b:t.isCheck?1:"",c:a,d:e.o(c=>n.errTypeChange(t,a),a)}))}:{},{c:i.feedType=="feedBack"},i.feedType=="feedBack"?{d:e.f(i.feedBackArr,(t,a,l)=>({a:e.t(t.value),b:t.isCheck?1:"",c:a,d:e.o(c=>n.errTypeChange(t,a),a)}))}:{},{e:e.p({label:"错误类型(可多选)",name:"type",required:!0}),f:e.o(t=>i.formData.feedbackContent=t),g:e.p({type:"textarea",placeholder:"欢迎您指出具体错误所在，并提供对应的正确描述。您的耐心指点，是我们前进的动力",modelValue:i.formData.feedbackContent}),h:e.p({label:"具体内容",name:"feedbackContent",required:!0}),i:e.o(u.successFreePhoto),j:e.o(u.fail),k:e.o(n.selectFreePhoto),l:e.p({limit:"3",title:"最多选择4张图片",["file-mediatype"]:"image",mode:"grid",limit:3}),m:e.p({label:"上传照片"}),n:e.o(t=>i.formData.contact=t),o:e.p({type:"text",placeholder:"请输入您的qq号或者手机号,方便我们联系您",modelValue:i.formData.contact}),p:e.p({label:"联系方式"}),q:e.sr("formRef","f11717fa-0"),r:e.o(t=>i.formData=t),s:e.p({["label-width"]:"100",["label-position"]:"top",rules:i.rules,modelValue:i.formData}),t:e.o(t=>n.submit("valiForm"))})}const k=e._export_sfc(m,[["render",F],["__file","C:/Users/sygen/Documents/HBuilderProjects/brushQuestion-front/pages/addErrorQuestion/index.vue"]]);wx.createPage(k);
