"use strict";const o=require("../common/vendor.js"),c=require("./http.js"),f={isWechat(){var e=window.navigator.userAgent.toLowerCase();return e.match(/micromessenger/i)=="micromessenger"},getUserInfo(){return new Promise((e,t)=>{o.index.getUserProfile({desc:"获取个人信息",success:n=>{e(n.userInfo)},fail:n=>{t(n)}})})},getJsCode(){return new Promise((e,t)=>{o.index.login({success(n){e(n.code)},fail:n=>{t(n)}})})},getUserPhone(e){let t={params:{openId:o.index.getStorageSync("openid"),sessionKey:o.index.getStorageSync("sessionKey"),encryptedDataUserInfo:o.index.getStorageSync("encryptedDataUserInfo"),ivUserInfo:o.index.getStorageSync("ivUserInfo"),encryptedData:e.encryptedData,iv:e.iv,unionId:e.cloudID},"Content-Type":"application/json",callBack:n=>{console.log("获取手机号",n),n&&o.index.switchTab({url:"/pages/my/my"})}};c.request("getPhone",t)},wxLogin(){o.index.login({provider:"weixin",success:function(e){if(e.errMsg==="login:ok"){let t={params:{code:e.code},callBack:n=>{o.index.setStorageSync("openid",n.openid),o.index.setStorageSync("sessionKey",n.sessionKey),o.index.setStorageSync("minAppNewUserFlag",n.minAppNewUserFlag),n.minAppNewUserFlag||(o.index.setStorageSync("userInfo",n),o.index.setStorageSync("token",n.token))},contentType:"application/x-www-form-urlencoded"};c.request("login",t)}}})},callWexinPay(e,t,n){e.appId;const i=e.timeStamp,r=e.nonceStr,g=e.packageValue,a=e.paySign,u=e.signType,l=e.desc;this.getWxConfig(()=>{o.wx$1.ready(function(){console.log(e),o.wx$1.chooseWXPay({timestamp:i,nonceStr:r,package:g,signType:u,paySign:a,desc:l,success:function(s){t(s)},fail:function(s){n(s)}})}),o.wx$1.error(function(s){})})},callWexinShare(e,t,n){this.getWxConfig(()=>{o.wx$1.ready(function(){console.log(JSON.stringify(e)),o.wx$1.updateAppMessageShareData({title:e.title,link:e.link,imgUrl:e.imgUrl,desc:e.desc,success:function(i){t(i)},cancel:function(i){n(i)}})}),o.wx$1.error(function(i){})})},scanQRCode(e,t){this.getWxConfig(()=>{o.wx$1.ready(function(){o.wx$1.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(n){var i=n.resultStr;e(i)},fail:function(n){t(n)}})}),o.wx$1.error(function(n){})})},getLocation(e,t){this.getWxConfig(()=>{o.wx$1.ready(function(){o.wx$1.getLocation({type:"wgs84",success:function(n){e(n)},fail:function(n){t(n)}})}),o.wx$1.error(function(n){})})}};exports.wechat=f;
